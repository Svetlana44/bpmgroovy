# Запуск приложения BPMSoft

## Рабочая конфигурация

Приложение настроено для запуска напрямую через Kestrel на портах:
- **HTTP**: `http://localhost:5001`
- **HTTPS**: `https://localhost:5003`

## Запуск приложения

### Команда для запуска:

```powershell
cd "C:\inetpub\wwwroot\BPMSoft_Full_House_1.6.0.190_Net8_PostgreSQL"
dotnet BPMSoft.WebHost.dll
```

**⚠️ ВАЖНО:** 
- Приложение запускается в консоли (PowerShell или CMD)
- **Не закрывайте окно консоли**, пока приложение работает
- Если закрыть консоль, приложение остановится
- Для остановки приложения нажмите `Ctrl+C` в окне консоли

### После запуска откройте в браузере:

- **HTTP**: `http://localhost:5001/Login/Login.html`
- **HTTPS**: `https://localhost:5003/Login/Login.html`

## Требования

### 1. Запустить инфраструктуру (PostgreSQL и Redis)

```powershell
cd BPMSoft\scripts
.\start-infrastructure.ps1
```

Или вручную:
```powershell
cd BPMSoft\scripts
docker-compose up -d
```

### 2. Проверить, что контейнеры запущены

```powershell
docker ps
```

Должны быть запущены:
- `bpmsoft-postgres` (PostgreSQL на порту 5432)
- `bpmsoft-redis` (Redis на порту 6379)

### 3. Восстановить базу данных (если нужно)

```powershell
cd BPMSoft\scripts
.\restore-database.ps1 -BackupPath "путь\к\бэкапу.backup"
```

## Конфигурация

### Порты приложения

Файл: `appsettings.json`
```json
{
	"Kestrel": {
		"Endpoints": {
			"Http": {
				"Url": "http://localhost:5001"
			},
			"Https": {
				"Url": "https://localhost:5003"
			}
		}
	}
}
```

### Строки подключения

Файл: `ConnectionStrings.config`

**PostgreSQL:**
```xml
<add name="db" connectionString="Pooling=true; Database=bpmsoft; Host=localhost; Port=5432; Username=bpmsoft_user; Password=ВАШ_ПАРОЛЬ; maxPoolSize=500; Timeout=5; CommandTimeout=400"/>
```

**Redis:**
```xml
<add name="redis" connectionString="host=localhost;port=6379;db=1"/>
```

## Параметры подключения

**PostgreSQL:**
- Host: `localhost`
- Port: `5432`
- Database: `bpmsoft`
- Username: `bpmsoft_user`
- Password: см. `scripts/docker-compose.yml` (параметр `POSTGRES_PASSWORD`)

**Redis:**
- Host: `localhost`
- Port: `6379`
- Database: `1`
- Password: нет (без пароля)

## Остановка приложения

Для остановки приложения:
1. Перейдите в окно консоли, где запущено приложение
2. Нажмите `Ctrl+C`
3. Дождитесь завершения работы приложения

**Примечание:** Если закрыть окно консоли без остановки (`Ctrl+C`), процесс может остаться в фоне. В этом случае найдите процесс `dotnet.exe` в диспетчере задач и завершите его.

## Остановка инфраструктуры

```powershell
cd BPMSoft\scripts
.\stop-infrastructure.ps1
```

Или:
```powershell
docker-compose stop
```

## Полезные команды

```powershell
# Проверить статус контейнеров
docker ps

# Проверить логи контейнеров
docker-compose logs -f

# Проверить подключение к PostgreSQL
docker exec bpmsoft-postgres psql -U bpmsoft_user -d bpmsoft -c "SELECT 1;"

# Проверить подключение к Redis
docker exec bpmsoft-redis redis-cli ping
```

